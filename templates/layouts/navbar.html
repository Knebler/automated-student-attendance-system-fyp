<nav class="navbar-custom">
  <a class="navbar-brand-custom" href="{{ url_for('main.home') }}">AttendAI</a>
  
  <button class="navbar-toggler-custom" onclick="toggleMobileMenu()">
      â˜°
  </button>
  
  <ul class="nav-links-custom" id="mobileMenu">
      {% if session.role %}
          {% set user_role = session.role if session.role else None %}
          {% set current_endpoint = request.endpoint if request.endpoint else None %}
          {% set current_path = request.path if request.path else None %}
          {% if user_role == 'platform_manager' %}
              <li><a class="nav-link-custom{% if current_endpoint == 'platform.platform_dashboard' %} active{% endif %}" href="{{ url_for('platform.platform_dashboard') }}">Dashboard</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'platform.user_management' %} active{% endif %}" href="{{ url_for('platform.user_management') }}">Users</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'platform.subscription_management' %} active{% endif %}" href="{{ url_for('platform.subscription_management') }}">Institutions/Subscriptions</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'platform.testimonial_review' %} active{% endif %}" href="{{ url_for('platform.testimonial_review') }}">Testimonials</a></li>
              <!-- <li><a class="nav-link-custom{% if current_endpoint == 'platform.performance_management' %} active{% endif %}" href="{{ url_for('platform.performance_management') }}">Performance</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'platform.settings_management' %} active{% endif %}" href="{{ url_for('platform.settings_management') }}">Settings</a></li> -->
              <li><a class="nav-link-custom{% if current_endpoint == 'platform.issue_management' %} active{% endif %}" href="{{ url_for('platform.issue_management') }}">Platform Issues</a></li>
          {% elif user_role == 'admin' %}
              <li><a class="nav-link-custom{% if current_endpoint == 'institution.institution_dashboard' %} active{% endif %}" href="{{ url_for('institution.institution_dashboard') }}">Dashboard</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'institution.attendance_reports' %} active{% endif %}" href="{{ url_for('institution.attendance_reports') }}">Attendance Reports</a></li>
              <li class="dropdown">
                  <a class="nav-link-custom dropdown-toggle{% if current_endpoint in ['institution.manage_users', 'institution.manage_classes', 'institution.manage_attendance', 'institution.manage_appeals', 'institution.manage_announcements'] %} active{% endif %}" href="#" id="managementDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Management</a>
                  <ul class="dropdown-menu" aria-labelledby="managementDropdown">
                      <li><a class="dropdown-item{% if current_endpoint == 'institution.manage_users' %} active{% endif %}" href="{{ url_for('institution.manage_users') }}">Manage Users</a></li>
                      <li><a class="dropdown-item{% if current_endpoint == 'institution.manage_classes' %} active{% endif %}" href="{{ url_for('institution.manage_classes') }}">Manage Classes</a></li>
                      <li><a class="dropdown-item{% if current_endpoint == 'institution.manage_attendance' %} active{% endif %}" href="{{ url_for('institution.manage_attendance') }}">Manage Attendance</a></li>
                      <li><a class="dropdown-item{% if current_endpoint == 'institution.manage_appeals' %} active{% endif %}" href="{{ url_for('institution.manage_appeals') }}">Manage Appeals</a></li>
                      <li><a class="dropdown-item{% if current_endpoint == 'institution.manage_announcements' %} active{% endif %}" href="{{ url_for('institution.manage_announcements') }}">Manage Announcements</a></li>
                  </ul>
              </li>
              <li><a class="nav-link-custom{% if current_endpoint == 'institution.import_data' %} active{% endif %}" href="{{ url_for('institution.import_data') }}">Import Data</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'main.my_reports' %} active{% endif %}" href="{{ url_for('main.my_reports') }}">My Reports</a></li>
          {% elif user_role == 'lecturer' %}
              <li><a class="nav-link-custom{% if current_endpoint == 'institution_lecturer.lecturer_dashboard' %} active{% endif %}" href="{{ url_for('institution_lecturer.lecturer_dashboard') }}">Dashboard</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'institution_lecturer.timetable' %} active{% endif %}" href="{{ url_for('institution_lecturer.timetable') }}">View Timetable</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'institution_lecturer.attendance_statistics' %} active{% endif %}" href="{{ url_for('institution_lecturer.attendance_statistics') }}">View Attendance Statistics</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'institution_lecturer.manage_classes' %} active{% endif %}" href="{{ url_for('institution_lecturer.manage_classes') }}">Manage Classes/Rosters</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'main.my_reports' %} active{% endif %}" href="{{ url_for('main.my_reports') }}">My Reports</a></li>

          {% elif user_role == 'student' %}
              <li><a class="nav-link-custom{% if current_endpoint == 'student.dashboard' %} active{% endif %}" href="{{ url_for('student.dashboard') }}">Dashboard</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'student.timetable' %} active{% endif %}" href="{{ url_for('student.timetable') }}">Timetable</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'student.attendance' %} active{% endif %}" href="{{ url_for('student.attendance') }}">View My Attendance</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'student.appeal_management' %} active{% endif %}" href="{{ url_for('student.appeal_management') }}">Attendance Appeal</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'student.facial_recognition_retrain' %} active{% endif %}" href="{{ url_for('student.facial_recognition_retrain') }}">Facial Recognition</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'student.profile' %} active{% endif %}" href="{{ url_for('student.profile') }}">Profile</a></li>
              <li><a class="nav-link-custom{% if current_endpoint == 'main.my_reports' %} active{% endif %}" href="{{ url_for('main.my_reports') }}">My Reports</a></li>
          {% endif %}
          
          <li><a class="nav-link-custom" href="{{ url_for('auth.logout') }}">Logout</a></li>
      {% else %}
          <!-- Public navigation -->
          {% set current_endpoint = request.endpoint if request.endpoint else None %}
          {% set current_path = request.path if request.path else None %}
          <li><a class="nav-link-custom{% if current_endpoint == 'main.features' or (current_path and '/features' in current_path) %} active{% endif %}" href="{{ url_for('main.features') }}">Features</a></li>
          <li><a class="nav-link-custom{% if current_endpoint == 'main.about' or (current_path and '/about' in current_path) %} active{% endif %}" href="{{ url_for('main.about') }}">About</a></li>
          <li><a class="nav-link-custom{% if current_endpoint == 'main.subscriptions' or (current_path and '/subscriptions' in current_path) %} active{% endif %}" href="{{ url_for('main.subscriptions') }}">Subscription</a></li>
          <li><a class="nav-link-custom{% if current_endpoint == 'main.testimonials' or (current_path and '/testimonials' in current_path) %} active{% endif %}" href="{{ url_for('main.testimonials') }}">Testimonials</a></li>
          <li><a class="nav-link-custom{% if current_endpoint == 'main.faq' or (current_path and '/faq' in current_path) %} active{% endif %}" href="{{ url_for('main.faq') }}">FAQ</a></li>
          
          <!-- Auth links -->
          <li><a class="nav-link-custom{% if current_endpoint == 'auth.login' or (current_path and '/login' in current_path) %} active{% endif %}" href="{{ url_for('auth.login') }}">Login</a></li>
          <li><a class="nav-link-custom{% if current_endpoint == 'auth.register' or (current_path and '/register' in current_path) %} active{% endif %}" href="{{ url_for('auth.register') }}">Register</a></li>
      {% endif %}
  </ul>
</nav>